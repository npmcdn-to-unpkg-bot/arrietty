<h1>Preferences</h1>


<%= form_for @user.preference, html: { multipart: true }, url: preference_path do |f| %>

<div class="field">
   <%= f.label :image, class: 'button' %>
   <%= f.file_field :image, 'class'=>'show-for-sr' %>
   <%= image_tag @user.preference.image.url(:medium), 'id'=>'image-preview'%>
 </div>

<div class="input-group">
  <%= f.label :display_name, class: 'input-group-label' %>
  <%= f.text_field :display_name, class: 'input-group-field' %>
</div>

<div><label>Email:</label>
<%= @user.email %>
</div>

<div><label>Notifications:</label>

<div class="form-group">
 <div>
 <%= f.check_box :notification_message %>
  <%= f.label :notification_message %>
 </div>
 <div>
  <%= f.check_box :notification_interest %>
  <%= f.label :notification_interest %>
</div>
<div>
  <%= f.label :about_me %>
  <%= f.text_area :about_me, class: "form-control" %><br />
</div>
 

<div class="input-group">
  <span class="input-group-label" >Location:</span>
  <input id="location" class="input-group-field" type="text">
  <div class="input-group-button">
    <input id='locateMeButton' type="button" class="button" value="Locate Me"/>
    <div id='loader' type="button" class='button hidden'>
      <div>
        <span class='fi-loop medium'></span>
      </div>
    </div>
  </div>


</div>

        

<script>
  $(function () {
    $('#locateMeButton').on('click', locateMe);
  });
  
  function locateMe(event) {
    event.preventDefault();
    $('#loader').removeClass('hidden').addClass('loading');
    $('#locateMeButton').addClass('hidden');
    navigator.geolocation.getCurrentPosition(function (pos) {
      $.ajax('/locate_me', {
          async: true,
          data: {
            position: pos
          },
          method: 'GET',
          dataType: 'json'
        })
        .done(function(result) {
          $('#location').val(result.address);
          $('#loader').addClass('hidden').removeClass('loading');
          $('#locateMeButton').removeClass('hidden');
        });
    }, null, null);
  }

$(function() {
    $('#preference_image').on('change', function(event) {
      var files = event.target.files;
      var image = files[0]
      var reader = new FileReader();
      reader.onload = function(file) {
        $('#image-preview').attr('src',file.target.result);
      }
      reader.readAsDataURL(image);
      console.log(files);
    });
  });

</script>
  <%= f.submit class: "button" %>
</div>
<% end %>